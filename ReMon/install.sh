#!/bin/bash
set -o errexit
set -o pipefail
set -o nounset
#set -o xtrace

################################################################################################################################################################
###################################################################### Build dependencies ######################################################################
################################################################################################################################################################
sudo apt update

# Required to build dependencies
sudo apt install -y gcc g++ cmake cmake-curses-gui bison flex python texinfo texi2html automake zlib1g-dev ccache
# Required to build MVEE
sudo apt install -y ruby libselinux-dev musl-tools libelf-dev libdwarf-dev libgmp-dev libmpfr-dev libmpc-dev libconfig-dev libcap-dev libunwind8 libunwind8-dev liblzma5 liblzma-dev libjsoncpp-dev

################################################################################################################################################################
###################################################################### Prepare build dir  ######################################################################
################################################################################################################################################################

mkdir build/
cd build/
cmake ..
make emulate-shm

################################################################################################################################################################
####################################################################### Do actual build  #######################################################################
################################################################################################################################################################
make -j$(nproc)
